<!DOCTYPE html>
<html>
<head>
  <title> <%= @book.title %> </title>
</head>
<body>

<h1>
  <%= @book.title %>
</h1>

<span>
  By: <%= @book.author.name %>
  <br>
  Genre: <%= @book.genre.genre_name %>
  <br>
  Published: <%= @book.year %>
</span>

<p>
  Synopsis:
  <br>
  <%= @book.description %>
  <br><br>
    Added by:<br>
   <%= @book.user.first_name %>
  </h5>
</p>

<% if current_user == @book.user %>
  <%= link_to 'Edit Book', edit_book_path %><br>
<% end%>

Reviews for <%= @book.title %>:
<ul>
<% @reviews.each do |review|%>
<div class="review-container">
  <div class="voting">
    <li> <%= link_to "Upvote", api_v1_review_upvote_path(review), class: "review-upvotes", method: :post, data: { review_id: review.id }, remote: true %> </li><br>

    <div id="upvote-count">
      <li>Upvotes: <%= review.upvotes.count %></li>
    </div><br>

    <li> <%= link_to "Downvote", api_v1_review_downvote_path(review), class: "review-upvotes", method: :post, data: { review_id: "#{review.id}"}, remote: true %> </li><br>

    <div id="downvote-count">
      Downvotes: <%= review.downvotes.count %>
    </div><br>
  </div>

  <li>
    <h3><%= review.title %></h3>
    <%= review.full_user_name %><br>
    Rating: <%= review.rating %> <br>
    <%= review.body %> <br>
    Reviewed on:  <%= review.created_at.strftime("%B %d, %Y") %>
  </li><br>
</div>
<% end %>
</ul>

<% if user_signed_in? %>
    <% unless Review.where(user_id: current_user.id, book_id: @book.id).any? %>
      <%= link_to 'Add Review', new_book_review_path(@book) %>
    <% end %>
<% else %>
  <p> Sign in to add a review! </p>
<% end %>

</body>
</html>

<%= paginate @reviews %>
