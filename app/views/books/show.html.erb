<!DOCTYPE html>
<html>
<head>
  <title> <%= @book.title %> </title>
</head>
<body>

<h1>
  <%= @book.title %>
</h1>

<span>
  By: <%= @book.author.name %>
  <br>
  Genre: <%= @book.genre.genre_name %>
  <br>
  Published: <%= @book.year %>
</span>

<p>
  Synopsis:
  <br>
  <%= @book.description %>
  <br><br>
    Added by:<br>
   <%= @book.user.first_name %>
  </h5>
</p>

Reviews for <%= @book.title %>:
<ul>
<% @reviews.each do |review|%>
  <li>
    <div class='review-upvotes'>
      <%= link_to "Upvote This Review", book_review_upvote_path(@book, review), data: { review_id: review.id }, remote: true, method: :post %><br>
    </div>

    <div class='review-downvotes'>
      <%= link_to "Downvote This Review", book_review_downvote_path(@book, review), data: { review_id: review.id }, remote: true, method: :post %><br>
    </div>

    Upvote: <%=review.upvotes.count %><br>
    Downvotes: <%=review.downvotes.count %><br>

    <h3><%= review.title %></h3>
    <%= review.full_user_name %><br>
    Rating: <%= review.rating %> <br>
    <%= review.body %> <br>
    Reviewed on:  <%= review.created_at.strftime("%B %d, %Y") %>
  </li><br>
<% end %>
</ul>

<% if user_signed_in? %>
    <% unless Review.where(user_id: current_user.id, book_id: @book.id).any? %>
      <%= link_to 'Add Review', new_book_review_path(@book) %>
    <% end %>
<% else %>
  <p> Sign in to add a review! </p>
<% end %>

</body>
</html>
